# Agent 开发与发布流程（完备版）

面向“选择类型 → 轻量对话 → 自动生成结构化产出”的零/低配置流程，覆盖：条款确认 → 开发进展 → 自测与验收 → 发布 → 云化编排。

## 阶段一：用户输入与条款确认
1) 用户输入简要需求（文档/对话/参考链接）。
2) 系统自动解析并根据模板预填，生成“一页式条款确认书”。
3) 仅对必要与敏感项进行总览确认（范围/场景、AC/NFR、时间线、预算、合规、IP、SLA）。
4) 通过域模型校验（必填、冲突、置信度、预算），输出草案与差异提示。

参考模板：`docs/templates/software_dev_terms_template.md`
域模型映射：`config/domain_schema/*.json`

## 阶段二：后台开发与实时进展
目标：让进展“有信息密度、可追踪、可验收”。

建议进展字段（结构化输出）：
- 状态：`解析中 / 设计中 / 开发中 / 联调中 / 验收中 / 已发布`
- 当前里程碑：名称、计划日期、完成百分比（%）
- 关键发现：最近 3–5 条（范围变化、依赖识别、性能风险等）
- 待确认项：必要条款缺失或冲突点（含置信度与建议）
- 风险清单：描述 / 影响 / 缓解策略（与 `risks.json` 对齐）
- 依赖项：内部 / 外部 / 第三方（与 `dependencies.json` 对齐）
- 成本与SLA：当期消耗、累计消耗、是否触达阈值、降级策略
- 下一步计划：最近 3 项可执行行动（行动 → 负责人 → 截止时间）

与仓库脚本协同（可选）：
- 校验：`scripts/domain_validate.py`、`scripts/validate_config.py`
- 路由解释：`scripts/routing_explain.py`
- 时间线视图：`scripts/timeline_view.py`
- 进展生成：`scripts/generate_progress.py`

## 阶段三：自测 → Agent 验收 → 人工总确认
1) 自测：单元/集成/回归；覆盖核心 AC（Given/When/Then）与关键 NFR（性能/可靠性/安全）。
2) Agent 验收：
   - 合同校验：所有必填项已完成、无冲突、置信度达阈值（默认 0.7）。
   - 指标校验：PRD 必要项、每个故事至少 1–3 条 AC、NFR 至少涵盖 3 类。
3) 人工总确认：
   - 最终条款确认（必要与敏感项一页式）
   - 版本冻结与变更记录（`CHANGELOG.md`）

## 阶段四：发布
1) 制品打包：结构化输出（`prd.json / stories.json / nfr.json / acceptance.json`）+ 文档（Markdown 报告）。
2) 版本推进与标签：`VERSION` 文件更新；流水线见 `.github/workflows/release.yaml`。
3) 上线清单：部署步骤、回滚方案、监控与告警策略、SLA 与支持联系人。

## 阶段五：云化工作流平台（编排已发布 Agent）
- 编排思路：将条款确认 → 结构化生成 → 校验 → 发布作为可复用节点。
- 运行治理：成本阈值、合规白名单、外部调用审批、审计日志与报表。
- 多 Agent 协作：生成、抽取、评审、编排、监控等角色协同，提升覆盖与效率。

## 完整性检查（退出条件）
- PRD 必要项全部完成（范围、场景、目标、功能、交付物）。
- 每个核心故事具备 AC（≥1–3 条），可自动化测试覆盖。
- NFR 覆盖性能/可靠性/安全/合规中 ≥3 类，阈值明确。
- 风险与依赖存在清单与缓解策略；预算与SLA明确。
- 人工总确认完成，版本冻结并进入发布流程。

## 常见问答
Q：这样做后能否“无敌”？
A：就工程化与治理而言，具备强可复制性与规模效应：
- 以条款确认书为中心的闭环，降低沟通成本与返工率。
- 结构化产出与自动验收，显著提升交付质量与可审计性。
- 云化工作流平台承载发布的 Agent，形成“流程即产品”的复用与增长飞轮。
边界仍在：合规审批、成本治理、外部依赖与人类最终裁决，这些是“强治理”的必要存在。

